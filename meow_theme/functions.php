<?php/**去除admin bar**/function my_function_admin_bar(){    return false;}add_filter('show_admin_bar', 'my_function_admin_bar');register_nav_menus();/** widgets */if (function_exists('register_sidebar')) {    register_sidebar(array(        'name' => 'First_sidebar',        'before_widget' => '',        'after_widget' => '',        'before_title' => '<h4>',        'after_title' => '</h4>'    ));    register_sidebar(array(        'name' => 'Second_sidebar',        'before_widget' => '',        'after_widget' => '',        'before_title' => '<h4>',        'after_title' => '</h4>'    ));    register_sidebar(array(        'name' => 'Third_sidebar',        'before_widget' => '',        'after_widget' => '',        'before_title' => '<h4>',        'after_title' => '</h4>'    ));    register_sidebar(array(        'name' => 'Fourth_sidebar',        'before_widget' => '',        'after_widget' => '',        'before_title' => '<h4>',        'after_title' => '</h4>'    ));}// Recently Updated Postsfunction recently_updated_posts($num = 10, $days = 7){    if (!$recently_updated_posts = get_option('recently_updated_posts')) {        query_posts('post_status=publish&orderby=modified&posts_per_page=-1');        $i = 0;        while (have_posts() && $i < $num) : the_post();            if (current_time('timestamp') - get_the_time('U') > 60 * 60 * 24 * $days) {                $i++;                $the_title_value = get_the_title();                $recently_updated_posts .= '<li><a href="' . get_permalink() . '" title="' . $the_title_value . '">'                    . $the_title_value . '</a><span class="updatetime"><br />» 修改时间: '                    . get_the_modified_time('Y.m.d G:i') . '</span></li>';            }        endwhile;        wp_reset_query();        if (!empty($recently_updated_posts)) update_option('recently_updated_posts', $recently_updated_posts);    }    $recently_updated_posts = ($recently_updated_posts == '') ? '<li>None data.</li>' : $recently_updated_posts;    echo $recently_updated_posts;}function clear_cache_zww(){    update_option('recently_updated_posts', ''); // 清空 recently_updated_posts}add_action('save_post', 'clear_cache_zww'); // 新发表文章/修改文章时触发更新/** * 文章模板 single.php 获取当前文章所属的分类名称 */function get_post_category_id($post_ID){    global $wpdb;    $sql = "SELECT `term_taxonomy_id` FROM $wpdb->term_relationships WHERE `object_id`='" . $post_ID . "';";    $cat_id = $wpdb->get_results($sql);    foreach ($cat_id as $catId) {        $output = $catId->term_taxonomy_id;    }    $myCatId = intval($output);//这里就获得当前文章所属分类的分类ID    $term = get_term($myCatId, '');//taxonomy_name为自己定义的或者默认的    echo $term->name;//得到当前文章所属分类的分类名称}//限制标题字符function ODD_title($char){    $title = get_the_title($post->ID);    $title = mb_substr($title, 0, $char, 'utf-8');    if ($char >= 40) {        echo $title . "...";    } else {        echo $title;    }}//添加特色缩略图支持if (function_exists('add_theme_support')) add_theme_support('post-thumbnails');//输出缩略图地址function post_thumbnail_src(){    global $post;    if ($values = get_post_custom_values("thumb")) {    //输出自定义域图片地址        $values = get_post_custom_values("thumb");        $post_thumbnail_src = $values [0];    } elseif (has_post_thumbnail()) {    //如果有特色缩略图，则输出缩略图地址        $thumbnail_src = wp_get_attachment_image_src(get_post_thumbnail_id($post->ID), 'full');        $post_thumbnail_src = $thumbnail_src [0];    } else {        $post_thumbnail_src = '';        ob_start();        ob_end_clean();        $output = preg_match_all('/<img.+src=[\'"]([^\'"]+)[\'"].*>/i', $post->post_content, $matches);        $post_thumbnail_src = $matches [1] [0];   //获取该图片 src        if (empty($post_thumbnail_src)) {    //如果日志中没有图片，则显示随机图片            echo bloginfo('template_url') . '/images/notfoundimages/0.jpg';        }    };    echo $post_thumbnail_src;}/* 访问计数 */function record_visitors(){    if (is_singular()) {        global $post;        $post_ID = $post->ID;        if ($post_ID) {            $post_views = (int)get_post_meta($post_ID, 'views', true);            if (!update_post_meta($post_ID, 'views', ($post_views + 1))) {                add_post_meta($post_ID, 'views', 1, true);            }        }    }}add_action('wp_head', 'record_visitors');/// 函数名称：post_views/// 函数作用：取得文章的阅读次数function post_views($before = '(点击 ', $after = ' 次)', $echo = 1){    global $post;    $post_ID = $post->ID;    $views = (int)get_post_meta($post_ID, 'views', true);    if ($echo) echo $before, number_format($views), $after;    else return $views;}//函数名称：content_main_text//函数作用：取得文章的钱$minword字function content_main_text($minword){    $allcontent = get_the_content($post->ID);    $allcontents = mb_substr($allcontent, 0, $minword, 'utf8');    $allcontent_num = mb_strlen($allcontent, 'UTF-8') . "";    if ($allcontent_num > $minword) {        echo $allcontents . "...";    } else {        echo $allcontent;    }}//获取评论数function get_comments_num($post_ID){    $sql = "SELECT comment_count FROM wp_posts WHERE comment_post_ID ='{$post_ID}' ";    $com_nums = $wpdb->get_results($sql);    echo $com_nums;}function par_pagenavi($range = 1){    if (is_singular()) return;    global $wp_query, $paged;    $max_page = $wp_query->max_num_pages;    if ($max_page == 1) return;    if (empty($paged)) $paged = 1;    echo '<span class="page-numbers">' . '第' . $paged . '页' . '(共' . $max_page . '页)' . ' </span>';    global $paged, $wp_query;    if (!$max_page) {        $max_page = $wp_query->max_num_pages;    }    if ($max_page > 1) {        if (!$paged) {            $paged = 1;        }        if ($paged != 1) {            echo "<a href='" . get_pagenum_link(1) . "' class='extend' title='跳转到首页'> NO.1 </a>";        }        previous_posts_link(' « ');        if ($max_page > $range) {            if ($paged < $range) {                for ($i = 1; $i <= ($range + 1); $i++) {                    echo "<a href='" . get_pagenum_link($i) . "'";                    if ($i == $paged) echo " class='current'";                    echo ">第{$i}页</a>";                }            } elseif ($paged >= ($max_page - ceil(($range / 2)))) {                for ($i = $max_page - $range; $i <= $max_page; $i++) {                    echo "<a href='" . get_pagenum_link($i) . "'";                    if ($i == $paged) echo " class='current'";                    echo ">第{$i}页i</a>";                }            } elseif ($paged >= $range && $paged < ($max_page - ceil(($range / 2)))) {                for ($i = ($paged - ceil($range / 2)); $i <= ($paged + ceil(($range / 2))); $i++) {                    echo "<a href='" . get_pagenum_link($i) . "'";                    if ($i == $paged) echo " class='current'";                    echo ">第{$i}页</a>";                }            }        } else {            for ($i = 1; $i <= $max_page; $i++) {                echo "<a href='" . get_pagenum_link($i) . "'";                if ($i == $paged) echo " class='current'";                echo ">第{$i}页</a>";            }        }        next_posts_link(' » ');        if ($paged != $max_page) {            echo "<a href='" . get_pagenum_link($max_page) . "' class='extend' title='跳转到最后一页'> 尾页 </a>";        }    }}function list_posts(){    $page = isset($_POST['nowPage']) ? $_POST['nowPage'] : "";    echo get_pagenum_link($page);    die();}add_action('wp_ajax_list_posts', 'list_posts');add_filter('gettext_with_context', 'wpdx_disable_open_sans', 888, 4);function wpdx_disable_open_sans($translations, $text, $context, $domain){    if ('Open Sans font: on or off' == $context && 'on' == $text) {        $translations = 'off';    }    return $translations;}